# 実装計画

- [x] 1. プロジェクト構造とコア設定のセットアップ
  - PHPプロジェクトの基本ディレクトリ構造を作成（src、tests、config、logs、public）
  - Composer設定ファイル（composer.json）を作成し、依存関係を定義（mPDF、PHPUnit、Eris）
  - 環境設定ファイル（.env.example）を作成し、必要な設定項目を定義
  - オートローダー設定とネームスペース定義を実装
  - _要件: 9.1, 9.2, 9.3, 9.4_

- [x] 2. データモデルクラスの実装
  - OrderData、Item、Part、ValidationResult、ParsedDataクラスを実装
  - 各クラスにプロパティとゲッター/セッターを定義
  - データモデルのバリデーションメソッドを実装
  - _要件: 2.1, 2.4, 2.5_

- [ ]* 2.1 データモデルのプロパティベーステスト
  - **Property 5: 複数アイテムの個別認識**
  - **検証対象: 要件 2.4**

- [ ]* 2.2 データモデルのプロパティベーステスト
  - **Property 6: 複数パーツの個別認識**
  - **検証対象: 要件 2.5**

- [x] 3. CSVパーサーの実装
  - CsvParserクラスを実装し、CSVファイルの読み込み機能を追加
  - セル内改行・カンマによる分割機能を実装（splitCellByNewline、splitCellByComma）
  - キーワードベースのデータ抽出機能を実装（extractByKeyword）
  - アイテムとパーツの解析ロジックを実装（parseItems、parseParts）
  - CSVファイルのバリデーション機能を実装
  - _要件: 2.1, 2.2, 2.3, 2.4, 2.5, 10.1_

- [ ]* 3.1 CSVパーサーのプロパティベーステスト
  - **Property 3: セル内区切り文字による要素抽出**
  - **検証対象: 要件 2.1, 2.2**

- [ ]* 3.2 CSVパーサーのプロパティベーステスト
  - **Property 4: キーワードベースのデータ分類**
  - **検証対象: 要件 2.3**

- [ ]* 3.3 CSVパーサーのプロパティベーステスト
  - **Property 21: 不正なCSV形式のエラー報告**
  - **検証対象: 要件 10.1**

- [x] 4. データ変換エンジンの実装
  - DataTransformerクラスを実装
  - 条件分岐による表示制御機能を実装（applyConditionalDisplay）
  - デフォルト値設定機能を実装（applyDefaultValues）
  - 数値フォーマット機能を実装（formatNumericValue）
  - 単位付与機能を実装（addUnit）
  - _要件: 4.1, 4.2, 4.3, 4.4, 5.1, 5.2, 5.4_

- [ ]* 4.1 データ変換エンジンのプロパティベーステスト
  - **Property 8: キーワードベースの表示制御**
  - **検証対象: 要件 4.1, 4.2**

- [ ]* 4.2 データ変換エンジンのプロパティベーステスト
  - **Property 9: 条件分岐の優先順位適用**
  - **検証対象: 要件 4.4**

- [ ]* 4.3 データ変換エンジンのプロパティベーステスト
  - **Property 10: 数値への単位付与**
  - **検証対象: 要件 5.1**

- [ ]* 4.4 データ変換エンジンのプロパティベーステスト
  - **Property 11: 小数点丸め処理**
  - **検証対象: 要件 5.2**

- [ ]* 4.5 データ変換エンジンのプロパティベーステスト
  - **Property 12: フィールド別数値変換ルール適用**
  - **検証対象: 要件 5.4**

- [x] 5. 計算エンジンの実装
  - CalculationEngineクラスを実装
  - パーツ数合計計算機能を実装（calculateTotalParts）
  - 総数量計算機能を実装（calculateTotalQuantity）
  - サイズ換算機能を実装（convertSize）
  - 条件付き計算機能を実装（applyConditionalCalculation）
  - 異常値検出とエラー処理を実装
  - _要件: 6.1, 6.2, 6.3, 6.4, 6.5_

- [ ]* 5.1 計算エンジンのプロパティベーステスト
  - **Property 13: パーツ数合計の正確性**
  - **検証対象: 要件 6.1**

- [ ]* 5.2 計算エンジンのプロパティベーステスト
  - **Property 14: 総数量計算の正確性**
  - **検証対象: 要件 6.2**

- [ ]* 5.3 計算エンジンのプロパティベーステスト
  - **Property 15: サイズ換算の正確性**
  - **検証対象: 要件 6.3**

- [ ]* 5.4 計算エンジンのプロパティベーステスト
  - **Property 16: 条件付き計算の正確性**
  - **検証対象: 要件 6.4**

- [ ]* 5.5 計算エンジンのプロパティベーステスト
  - **Property 17: 異常値のエラー検出**
  - **検証対象: 要件 6.5**

- [ ] 6. チェックポイント - すべてのテストが通ることを確認
  - すべてのテストが通ることを確認し、問題があればユーザーに質問する

- [x] 7. PDF生成エンジンの実装
  - PdfGeneratorクラスを実装し、mPDFライブラリを統合
  - A4縦サイズのPDF生成機能を実装
  - ヘッダー部分のレンダリング機能を実装（renderHeader）
  - アイテムブロックのレンダリング機能を実装（renderItemBlock）
  - パーツテーブルのレンダリング機能を実装（renderPartsTable）
  - 複数ページ対応のレイアウト制御を実装
  - PDFファイルの保存機能を実装（savePdf）
  - _要件: 3.1, 3.2, 3.3, 3.4, 3.5_

- [ ]* 7.1 PDF生成エンジンのプロパティベーステスト
  - **Property 7: PDF用紙サイズの一貫性**
  - **検証対象: 要件 3.1**

- [ ]* 7.2 PDF生成エンジンのプロパティベーステスト
  - **Property 22: PDF生成エラーの適切な処理**
  - **検証対象: 要件 10.2**

- [ ] 8. 認証モジュールの実装
  - AuthControllerクラスを実装
  - ログインフォーム表示機能を実装（showLoginForm）
  - ログイン処理を実装（login）、パスワードハッシュ化を含む
  - ログアウト処理を実装（logout）
  - セッション管理機能を実装（isAuthenticated）
  - _要件: 8.1, 8.2, 8.3, 8.4_

- [ ]* 8.1 認証モジュールのプロパティベーステスト
  - **Property 18: 有効な認証情報でのログイン成功**
  - **検証対象: 要件 8.2**

- [ ]* 8.2 認証モジュールのプロパティベーステスト
  - **Property 19: 無効な認証情報でのログイン拒否**
  - **検証対象: 要件 8.3**

- [ ]* 8.3 認証モジュールのプロパティベーステスト
  - **Property 20: ログアウト時のセッション終了**
  - **検証対象: 要件 8.4**

- [ ] 9. アップロードコントローラの実装
  - UploadControllerクラスを実装
  - ファイルアップロード処理を実装（handleUpload）
  - ファイルバリデーション機能を実装（validateFile）
  - ファイルタイプ、サイズ、セキュリティチェックを実装
  - 一時ファイル保存機能を実装（saveTemporaryFile）
  - _要件: 1.2, 1.5, 10.3_

- [ ]* 9.1 アップロードコントローラのプロパティベーステスト
  - **Property 2: 非CSV形式の拒否**
  - **検証対象: 要件 1.5**

- [ ] 10. エラーハンドリングとログ記録の実装
  - カスタム例外クラスを実装（ValidationException、PdfGenerationException）
  - エラーハンドリングミドルウェアを実装
  - ログ記録機能を実装（Monologライブラリを使用）
  - エラーレスポンスフォーマッターを実装
  - _要件: 10.1, 10.2, 10.4_

- [ ]* 10.1 エラーハンドリングのプロパティベーステスト
  - **Property 23: システムエラーのログ記録**
  - **検証対象: 要件 10.4**

- [ ] 11. Webインターフェースの実装
  - ログインページのHTMLとCSSを作成
  - CSVアップロードページのHTMLとCSSを作成
  - JavaScriptでファイル選択とアップロード処理を実装
  - PDFダウンロード機能を実装
  - レスポンシブデザインを適用
  - _要件: 1.1, 1.2, 1.4_

- [x] 12. メインアプリケーションフローの統合
  - ルーティング設定を実装（Slim FrameworkまたはバニラPHP）
  - リクエストハンドラーを実装し、各コンポーネントを連携
  - CSVアップロード → パース → 変換 → 計算 → PDF生成のフローを実装
  - セッション管理とアクセス制御を統合
  - _要件: 1.2, 1.3, 1.4_

- [ ]* 12.1 エンドツーエンドのプロパティベーステスト
  - **Property 1: CSVからPDFへの完全な変換**
  - **検証対象: 要件 1.2, 1.3, 1.4**

- [ ] 13. 設定ファイルとテンプレートシステムの実装
  - CSV解析ルール設定ファイル（YAML/JSON）を作成
  - データ変換ルール設定ファイルを作成
  - 計算ルール設定ファイルを作成
  - 設定ファイル読み込み機能を実装
  - テンプレートインターフェースを実装（ReportTemplate）
  - ピッキング帳票テンプレートを実装（PickingReportTemplate）
  - _要件: 7.1, 7.4_

- [ ] 14. セキュリティ機能の実装
  - CSVインジェクション対策を実装
  - パストラバーサル対策を実装
  - ファイル名サニタイゼーション機能を実装
  - セッションセキュリティ設定を実装（HTTPOnlyフラグ、タイムアウト）
  - 本番環境用エラーメッセージ制御を実装
  - _要件: 8.1, 8.2, 8.3, 8.4_

- [ ] 15. パフォーマンス最適化の実装
  - 大きなCSVファイルのストリーミング処理を実装
  - 一時ファイルの自動クリーンアップ機能を実装
  - PHPメモリ制限とタイムアウト設定を最適化
  - ファイルロック機能を実装
  - _要件: 10.3_

- [ ] 16. デプロイメント設定の作成
  - Apache用.htaccessファイルを作成
  - Nginx用設定ファイルサンプルを作成
  - 環境別設定ファイル（.env.local、.env.production）を作成
  - デプロイメント手順書（README.md）を作成
  - _要件: 9.1, 9.2, 9.3, 9.4_

- [ ] 17. 最終チェックポイント - すべてのテストが通ることを確認
  - すべてのテストが通ることを確認し、問題があればユーザーに質問する
