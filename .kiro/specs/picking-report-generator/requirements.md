# 要件定義書

## はじめに

本システムは、受注データ（CSV形式）から社内用ピッキング帳票（PDF形式）を自動生成するWebアプリケーションです。現在使用している「Robot-in」標準帳票の使いづらさを解消し、社内業務に最適化された帳票を簡単に出力できるようにします。2026年に向けたDX推進の中核として、継続的な機能拡張が可能なシステム基盤を構築します。

## 用語集

- **システム**: ピッキング帳票生成システム
- **ユーザー**: 社内の受注処理担当者
- **受注データ**: CSV形式で提供される注文情報
- **ピッキング帳票**: 倉庫作業者が使用する商品ピッキング用の印刷帳票
- **アイテム**: 受注データ内の個別商品単位
- **パーツ**: アイテムを構成する部品や要素
- **Webポータル**: ブラウザからアクセスする社内用Webインターフェース
- **mPDF**: PHP用のPDF生成ライブラリ
- **TCPDF**: PHP用のPDF生成ライブラリ（代替候補）
- **dompdf**: PHP用のPDF生成ライブラリ（代替候補）

## 要件

### 要件1

**ユーザーストーリー:** 受注処理担当者として、CSVファイルをアップロードしてピッキング帳票PDFを生成したいので、手作業での帳票作成時間を削減できる

#### 受入基準

1. WHEN ユーザーがWebポータルにアクセスする THEN システムはCSVファイルアップロード用のUIを表示する
2. WHEN ユーザーがCSVファイルを選択してアップロードボタンをクリックする THEN システムはファイルを受け付けて処理を開始する
3. WHEN CSVファイルの処理が完了する THEN システムは生成されたPDFファイルをダウンロード可能な状態にする
4. WHEN ユーザーがダウンロードボタンをクリックする THEN システムは生成されたPDFファイルをユーザーのブラウザにダウンロードする
5. WHEN アップロードされたファイルがCSV形式でない THEN システムはエラーメッセージを表示してファイルを拒否する

### 要件2

**ユーザーストーリー:** 受注処理担当者として、複雑な構造のCSVデータを正確に解析してほしいので、データの取り違えや欠落を防ぎたい

#### 受入基準

1. WHEN CSVファイルにセル内改行を含むデータが存在する THEN システムは改行で区切られた各要素を個別に抽出する
2. WHEN CSVファイルにセル内カンマを含むデータが存在する THEN システムはカンマで区切られた各要素を個別に抽出する
3. WHEN CSVファイルに特定キーワード（例：「アイテム：」「パーツ：」）を含むデータが存在する THEN システムはキーワードを基準にデータを分類して抽出する
4. WHEN 1つの受注データに複数のアイテムが含まれる THEN システムは各アイテムを個別のブロックとして認識する
5. WHEN 1つのアイテムに複数のパーツが含まれる THEN システムは各パーツを個別の要素として認識する

### 要件3

**ユーザーストーリー:** 受注処理担当者として、Googleスプレッドシート版と同じレイアウトのPDFを出力してほしいので、現場作業者が混乱せずに使える

#### 受入基準

1. WHEN PDFを生成する THEN システムはA4縦サイズで出力する
2. WHEN 受注データが1ページに収まらない THEN システムは複数ページに分割して出力する
3. WHEN アイテムブロックをレイアウトする THEN システムはGoogleスプレッドシート版フォーマットと同じ配置・罫線・フォントサイズで表示する
4. WHEN パーツ情報をレイアウトする THEN システムはGoogleスプレッドシート版フォーマットと同じ配置・罫線・フォントサイズで表示する
5. WHEN ヘッダー情報（受注番号、日付など）をレイアウトする THEN システムはGoogleスプレッドシート版フォーマットと同じ位置・スタイルで表示する

### 要件4

**ユーザーストーリー:** 受注処理担当者として、データの有無に応じて表示内容を自動調整してほしいので、不要な情報で帳票が煩雑にならないようにしたい

#### 受入基準

1. WHEN CSVデータに「あり」「○」などの肯定キーワードが含まれる THEN システムは対応する項目を表示する
2. WHEN CSVデータに「なし」「×」などの否定キーワードが含まれる THEN システムは対応する項目を非表示にする
3. WHEN CSVデータの特定フィールドが空欄である THEN システムはデフォルト値（例：「-」「指定なし」）を表示する
4. WHEN 条件分岐ルールが複数適用される THEN システムは優先順位に従って表示制御を実行する

### 要件5

**ユーザーストーリー:** 受注処理担当者として、数値データを適切な形式と単位で表示してほしいので、現場作業者が正確に理解できる

#### 受入基準

1. WHEN CSVデータに数値（例：36.0）が含まれる THEN システムは指定された単位（例：「タテ36cm」）を付与して表示する
2. WHEN 数値に小数点以下の桁数指定がある THEN システムは指定された桁数で丸め処理を実行する
3. WHEN 数値がゼロまたは空欄である THEN システムは適切なデフォルト表示（例：「0」「-」）を行う
4. WHEN 数値変換ルールが複数のフィールドに適用される THEN システムは各フィールドに対応するルールを正確に適用する

### 要件6

**ユーザーストーリー:** 受注処理担当者として、元データに存在しない計算値を自動算出してほしいので、手計算のミスを防ぎたい

#### 受入基準

1. WHEN パーツ数の合計が必要である THEN システムは各アイテムのパーツ数を集計して表示する
2. WHEN 総数量の計算が必要である THEN システムは数量フィールドを基に総数量を計算して表示する
3. WHEN サイズ換算（例：cm→m、個→箱）が必要である THEN システムは指定された換算式を適用して計算結果を表示する
4. WHEN 条件付き計算（例：特定条件下でのみ加算）が必要である THEN システムは条件を評価してから計算を実行する
5. WHEN 計算結果が数値範囲外または異常値である THEN システムはエラーメッセージを表示して処理を中断する

### 要件7

**ユーザーストーリー:** システム管理者として、将来的に機能拡張できる設計にしてほしいので、新しい要件に柔軟に対応できる

#### 受入基準

1. WHEN 新しい帳票種類を追加する THEN システムは既存機能に影響を与えずに新しいテンプレートを追加できる
2. WHEN QRコード埋め込み機能を追加する THEN システムはPDF生成ロジックを大幅に変更せずに機能を追加できる
3. WHEN 印刷設定のカスタマイズ機能を追加する THEN システムは既存のPDF出力機能を拡張できる
4. WHEN CSV仕様が変更される THEN システムは解析ロジックの該当部分のみを修正して対応できる

### 要件8

**ユーザーストーリー:** 社内ユーザーとして、簡単にログインして安全に利用したいので、不正アクセスを防ぎつつ使いやすさを保ちたい

#### 受入基準

1. WHEN ユーザーがシステムにアクセスする THEN システムはログイン画面を表示する
2. WHEN ユーザーが正しい認証情報を入力する THEN システムはユーザーをWebポータルにリダイレクトする
3. WHEN ユーザーが誤った認証情報を入力する THEN システムはエラーメッセージを表示してログインを拒否する
4. WHEN ユーザーがログアウトする THEN システムはセッションを終了してログイン画面にリダイレクトする

### 要件9

**ユーザーストーリー:** システム管理者として、ローカル・社内サーバ・外部VPSのいずれでも稼働できるようにしてほしいので、環境に応じた柔軟な運用ができる

#### 受入基準

1. WHEN システムをローカル環境にデプロイする THEN システムはローカルホストで正常に動作する
2. WHEN システムを社内サーバにデプロイする THEN システムは社内ネットワーク内で正常に動作する
3. WHEN システムを外部VPSにデプロイする THEN システムはインターネット経由で正常に動作する
4. WHEN 環境設定ファイルを変更する THEN システムは再デプロイせずに設定を反映できる

### 要件10

**ユーザーストーリー:** 受注処理担当者として、処理中のエラーを明確に知りたいので、問題を迅速に解決できる

#### 受入基準

1. WHEN CSVファイルの形式が不正である THEN システムは具体的なエラー内容（例：「3行目：必須フィールドが欠落」）を表示する
2. WHEN PDF生成中にエラーが発生する THEN システムはエラーメッセージを表示して処理を中断する
3. WHEN ファイルサイズが上限を超える THEN システムはアップロードを拒否してファイルサイズ制限を通知する
4. WHEN システムエラーが発生する THEN システムはユーザーフレンドリーなエラーメッセージを表示してログに詳細を記録する
