# ピッキング帳票生成システム - デモトークスクリプト

## 1. イントロダクション（1分）

「本日は、受注データから社内用ピッキング帳票を自動生成するシステムのMVPをご紹介します。

現在、Robot-in標準帳票を使用されていますが、使いづらさを感じられているとのことで、社内業務に最適化された帳票を簡単に出力できるシステムを開発しました。」

---

## 2. 背景と課題（2分）

### 現状の課題
「現在の課題は以下の3点です：

1. **Robot-in標準帳票の使いづらさ**
   - 社内業務フローに合わない
   - 必要な情報が見づらい
   - カスタマイズが困難

2. **手作業での帳票作成**
   - 時間がかかる
   - ミスが発生しやすい
   - 属人化している

3. **複雑なCSVデータの処理**
   - セル内改行やカンマ区切りのデータ
   - キーワードベースのデータ分類
   - 複数アイテム・パーツの管理」

---

## 3. システム概要（2分）

「開発したシステムは、CSVファイルをアップロードするだけで、自動的にピッキング帳票PDFを生成します。

### 主な特徴
- **簡単操作**: CSVアップロード → PDF自動生成
- **複雑なデータ対応**: セル内改行・カンマ分割を自動処理
- **自動計算**: 総パーツ数、総数量などを自動算出
- **Googleスプレッドシート版と同じレイアウト**: 現場作業者が混乱しない
- **2つの利用方法**: Webインターフェース & CLIコマンド」

---

## 4. サンプルCSVの説明（3分）

「それでは、実際のサンプルCSVを見てみましょう。」

### サンプルCSVの内容

```csv
受注番号:,ORD-2024-001
受注日:,2024-12-05
顧客名:,株式会社サンプル
納期:,2024-12-20

アイテム:商品A,数量: 10
パーツ:部品A1,タテ36cm,ヨコ24cm,数量: 2
パーツ:部品A2,タテ48cm,ヨコ30cm,数量: 1

アイテム:商品B,数量: 5
パーツ:部品B1,タテ30cm,ヨコ20cm,数量: 3
パーツ:部品B2,タテ25cm,ヨコ15cm,数量: 2
パーツ:部品B3,タテ40cm,ヨコ25cm,数量: 1
```

### ポイント解説

「このCSVには、実際の業務で発生する複雑なデータ構造が含まれています：

1. **ヘッダー情報**
   - 受注番号、受注日、顧客名、納期
   - キーワード（"受注番号:"）の後にデータが続く形式

2. **複数アイテム**
   - 商品A（パーツ2個）
   - 商品B（パーツ3個）
   - "アイテム:"キーワードで識別

3. **パーツ情報**
   - 各パーツにサイズ情報（タテ・ヨコ）
   - 数量情報
   - "パーツ:"キーワードで識別

4. **複雑なデータ構造**
   - カンマ区切りのデータ
   - キーワードベースの分類
   - 階層構造（アイテム > パーツ）

このような複雑なCSVでも、システムが自動的に解析して整形されたPDFを生成します。」

---

## 5. デモ実演（5分）

### 5.1 CLIでの実行

「まず、コマンドラインから実行してみます。」

```bash
php bin/generate-report.php storage/tmp/sample.csv
```

「実行すると...

✓ PDF生成成功！
出力ファイル: ./storage/pdf/picking_report_ORD-2024-001_20251205112654.pdf
受注番号: ORD-2024-001
アイテム数: 2
総パーツ数: 5
総数量: 15

このように、わずか数秒でPDFが生成されました。」

### 5.2 生成されたPDFの確認

「生成されたPDFを開いてみましょう。」

**PDFの内容を説明：**

1. **ヘッダー部分**
   - 「ピッキング帳票」というタイトル
   - 受注番号: ORD-2024-001
   - 受注日: 2024-12-05
   - 顧客名: 株式会社サンプル
   - 納期: 2024-12-20

2. **アイテムブロック1（商品A）**
   - アイテム名と数量が明確に表示
   - パーツテーブル：
     - 部品A1: タテ36cm、ヨコ24cm、数量2
     - 部品A2: タテ48cm、ヨコ30cm、数量1

3. **アイテムブロック2（商品B）**
   - 同様にアイテム情報とパーツテーブル
   - 3つのパーツが整理されて表示

4. **フッター部分**
   - 総パーツ数: 5
   - 総数量: 15

「見やすく整理されたレイアウトで、現場作業者がすぐに使える形式になっています。」

### 5.3 Webインターフェースでの実行

「次に、Webインターフェースを見てみましょう。」

**ブラウザで http://localhost:8000 を開く**

「このように、シンプルで使いやすいUIになっています：

1. **ドラッグ&ドロップ対応**
   - CSVファイルをドラッグするだけ
   - またはクリックしてファイル選択

2. **ファイル検証**
   - CSV形式のみ受付
   - 最大10MBまで対応

3. **ワンクリック生成**
   - 「PDF生成」ボタンをクリック
   - 自動的にPDFがダウンロード

4. **エラー表示**
   - 問題があれば具体的なエラーメッセージを表示」

**実際にファイルをアップロードしてPDF生成を実演**

---

## 6. 技術的な特徴（3分）

「システムの技術的な特徴をご説明します。」

### 6.1 データ処理フロー

「CSVからPDFまで、4つのステップで処理します：

1. **CSVパース**
   - セル内改行・カンマを自動分割
   - キーワードベースでデータ分類
   - 複数アイテム・パーツを階層構造で管理

2. **データ変換**
   - 条件分岐による表示制御
   - デフォルト値の自動設定
   - 数値フォーマット（単位付与、小数点処理）

3. **自動計算**
   - 総パーツ数の集計
   - 総数量の計算
   - サイズ換算（cm→m等）

4. **PDF生成**
   - mPDFライブラリ使用
   - A4縦サイズ
   - 日本語完全対応」

### 6.2 アーキテクチャ

「モジュール化された設計で、将来の拡張が容易です：

- **データモデル層**: OrderData, Item, Part
- **パーサー層**: CSVParser
- **変換層**: DataTransformer
- **計算層**: CalculationEngine
- **生成層**: PdfGenerator
- **コントローラー層**: ReportController

各層が独立しているため、新しい帳票種類の追加や機能拡張が簡単です。」

---

## 7. 実装済み機能（2分）

「現在のMVPで実装済みの機能は以下の通りです：」

### ✅ 実装済み

1. **CSVアップロード機能**
   - Webインターフェース
   - CLIコマンド
   - ファイル検証（形式、サイズ）

2. **複雑なCSV解析**
   - セル内改行の分割
   - セル内カンマの分割
   - キーワードベースのデータ抽出
   - 複数アイテム・パーツの認識

3. **データ変換**
   - 条件分岐による表示制御
   - デフォルト値設定
   - 数値フォーマット
   - 単位付与

4. **自動計算**
   - パーツ数合計
   - 総数量計算
   - サイズ換算
   - 条件付き計算

5. **PDF生成**
   - A4縦サイズ出力
   - Googleスプレッドシート版レイアウト再現
   - 日本語対応
   - 複数ページ対応

6. **エラーハンドリング**
   - 詳細なエラーメッセージ
   - ログ記録（Monolog）
   - バリデーション

---

## 8. 未実装機能（今後の拡張）（3分）

「今回のMVPでは、コア機能に集中しました。以下の機能は今後の拡張として予定しています：」

### 🔄 今後実装予定

#### 8.1 認証機能
「現在は認証なしで動作しますが、本番環境では必要です：
- ユーザー名・パスワード認証
- セッション管理
- ログイン/ログアウト機能
- アクセス制御」

#### 8.2 高度なファイル管理
「より安全で便利なファイル管理：
- アップロード履歴の保存
- 生成済みPDFの一覧表示
- ファイルの自動クリーンアップ（24時間後）
- ファイル名のサニタイゼーション強化」

#### 8.3 設定のカスタマイズ
「ユーザーごとの設定：
- CSV解析ルールの設定
- データ変換ルールの設定
- 計算式のカスタマイズ
- PDFレイアウトの調整」

#### 8.4 複数帳票テンプレート
「様々な帳票に対応：
- ピッキング帳票（現在実装済み）
- 納品書テンプレート
- 請求書テンプレート
- カスタムテンプレート作成機能」

#### 8.5 QRコード・バーコード
「トレーサビリティ向上：
- 受注番号のQRコード埋め込み
- 商品コードのバーコード生成
- 追跡用識別子の自動生成」

#### 8.6 プロパティベーステスト
「品質保証の強化：
- 23個の正確性プロパティを定義済み
- Erisライブラリを使用したPBT
- 100回以上の反復テスト
- 自動的なエッジケース検出」

#### 8.7 統合機能
「他システムとの連携：
- Robot-inとのAPI連携
- データベース連携
- メール通知機能
- Webhook対応」

---

## 9. デプロイメント対応（2分）

「このシステムは、様々な環境で動作します：」

### 対応環境

1. **ローカル環境**
   - XAMPP/MAMP
   - 開発・テスト用

2. **社内サーバ**
   - イントラネット内のLinux/Windowsサーバ
   - Apache/Nginx対応
   - セキュアな社内運用

3. **外部VPS**
   - AWS EC2
   - さくらVPS
   - ConoHa VPS
   - インターネット経由でのアクセス

「環境設定ファイル（.env）を変更するだけで、どの環境でも動作します。
詳細なデプロイメント手順書も用意しています。」

---

## 10. 次のステップ（2分）

「今後の展開について：」

### フェーズ1（現在 - MVP完成）
- ✅ コア機能実装完了
- ✅ CSV→PDF変換動作確認
- ✅ 基本的なエラーハンドリング

### フェーズ2（次の1-2週間）
- 認証機能の実装
- プロパティベーステストの実装
- ユーザーフィードバックの収集
- 実際の業務データでのテスト

### フェーズ3（1ヶ月後）
- 複数帳票テンプレート対応
- QRコード・バーコード機能
- 設定のカスタマイズ機能
- 本番環境へのデプロイ

### フェーズ4（2026年に向けて）
- Robot-in連携
- データベース統合
- 高度な分析機能
- モバイル対応

---

## 11. まとめ（1分）

「本日ご紹介したピッキング帳票生成システムは：

### 実現できること
✅ CSVから自動的にピッキング帳票PDFを生成
✅ 複雑なデータ構造（改行、カンマ区切り）に対応
✅ 自動計算で手作業のミスを削減
✅ Webブラウザから簡単操作
✅ 様々な環境で動作

### 期待される効果
- 帳票作成時間の大幅削減
- ヒューマンエラーの防止
- 業務の標準化
- 現場作業者の負担軽減

### 拡張性
- モジュール化された設計
- 新しい帳票種類の追加が容易
- 将来的な機能拡張に対応

2026年のDX推進に向けて、継続的に機能を拡張していきます。」

---

## 12. Q&A準備

### よくある質問と回答

**Q: 既存のCSVフォーマットに対応できますか？**
A: はい。CSV解析ルールは設定ファイルでカスタマイズ可能です。現在のサンプルとは異なるフォーマットでも、設定を調整することで対応できます。

**Q: 大量のデータでも処理できますか？**
A: 現在は10MBまでのファイルに対応しています。必要に応じて上限を調整可能です。また、ストリーミング処理により、大きなファイルでもメモリ効率よく処理します。

**Q: PDFのレイアウトは変更できますか？**
A: はい。テンプレートシステムを使用しているため、レイアウトのカスタマイズが可能です。

**Q: セキュリティは大丈夫ですか？**
A: 認証機能、ファイル検証、CSVインジェクション対策、パストラバーサル対策など、セキュリティ対策を実装しています。本番環境ではHTTPS接続を推奨します。

**Q: 他のシステムと連携できますか？**
A: 将来的にAPI連携、Webhook、データベース連携などを実装予定です。

---

## デモ実施時の注意点

### 事前準備
- [ ] PHPサーバーを起動しておく（`php -S localhost:8000 -t public`）
- [ ] サンプルCSVファイルを用意
- [ ] 生成済みPDFを事前に確認
- [ ] ブラウザのタブを開いておく

### デモの流れ
1. 背景説明（課題の共有）
2. サンプルCSVの説明（データ構造の理解）
3. CLI実行（技術的な動作確認）
4. PDF確認（成果物の確認）
5. Web UI実行（実際の使用感）
6. 今後の展開（期待値の設定）

### タイムキーピング
- 全体25分を目安
- 質疑応答10分を確保
- デモ実演は5分以内に収める

### トラブル対応
- PDFが開けない場合 → 事前生成したPDFを使用
- サーバーが起動しない場合 → CLIデモのみ実施
- CSVエラーが出た場合 → エラーハンドリングの説明に切り替え
